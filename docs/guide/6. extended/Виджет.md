# Виджет

*Идея виджетов пока сырая, развивается по мере использования.*

Чтобы понять, что я называю виджетом, начну со схожего понятия.

***Компонент*** - отдельный максимально изолированный блок сайта, имеющий широкую область применения.

Простой пример: капча (captcha). Моя реализация умещается в один класс, зато область применения не привязана вообще ни к какому конкретному месту. Captcha это кандидат на перенос в отдельную библиотеку. И тогда ее место будет в [vendors/]. Собственно это и есть признак компонента, но разница в том, что компонент обычно создается под конкретный проект и не оформляется, как внешняя библиотека.

***Виджет*** - компонент + шаблон. Т.е. блок кода, обладающий признаками компонента, но при этом имеющий шаблон (или несколько) для отрисовки. Почти наверняка, шаблон виджета будет завязан на стили сайта, так что о переезде [vendors/] тут речь не идет. **Вся статика виджета так же хранится с ним в каталоге или в подкаталогах.** Со сборщиком статики это не является проблемой.

Возможные примеры виджетов: лента комментариев, форма обратной связи, простой календарь с какими-нибудь данными. Т.е. всё это фрагменты конечного шаблона страницы, но при этом страница явно неопределена.

Виджеты можно и нужно внедрять в шаблоны проекта через метод `kira\web\Controller::widget()`.

Виджет нацелен на генерацию шаблона, а не бизнес-логику. Это значит, что не нужно размещать в нем обработчики запросов бразуера, валидацию, формирование полного ответа и т.д. Только необходимый минимум php/js кода для сборки своего представления и всё. Если же хочется разместить бизнес-логику рядом, тогда не объявляйте компонент виджетом. И тут диллема: а если нужен компонент выполняющий две роли? Или это грубое нарушение SRP - [Single Responsibility Principle](https://ru.wikipedia.org/wiki/Принцип_единственной_ответственности)?


## Реализация

Класс `kira\web\Widget`

*TODO переписать этот абзац. Статическим остался только один метод.*

Полустатический супер-класс `kira\web\Widget` представляет собой минимальный необходимый набор методов для поддержки движком. Методы можно перепределить в потомках, разумеется. Статичными объявлены методы и свойства, которые в потомках могут быть одинаковыми. Иными словами - это методы, относящиеся к шаблонам (views). А вот данные, передаваемые в эти шаблоны, могут отличаться у экземпляров одного класса виджета, поэтому методы динамические.

В потомке, как минимум, должно быть определено свойство `$view` - имя файла шаблона без расширения. Это в самой простой реализации. При этом ожидается, что файл лежит в одном каталоге с классом виджета и имеет расширение, заданное в `Widget::$viewExt`. В более сложных случаях возможно потребуется переопределение метода `Widget::getView()`. При этом важно помнить, что метод должен возвращать **абсолютный путь + имя + расширение** файла шаблона. Это связанно с тем, что шаблоны должны располагаться в каталоге виджета или его подкаталогах (согласно определения виджета, см. выше), следовательно движок не будет искать шаблон в каталоге `KIRA_VIEWS_PATH` и ожидает полный путь к нему.
