# Локализация сайта

Русский язык - основной, ему словари не нужны. Он забит хардкодом, потому что все сообщения движка на русском. Я не придумал красивое решение для этой ситуации. Не хочу создавать словари для любого языка, даже если языковая поддержка не нужна.
 
*Прим.: мастер создания приложения может создать пример мультиязычного приложения. См. док "Организация файлов > Мастер создания приложения"*

Движок определяет текущий язык из печеньки (cookie) `lang`. В ней должны быть записаны 2-3 латинские буквы, совпадающее с названием словаря. Нет печеньки - считаем, что задан русский. 

Печеньку можно создавать при переключении языка. Пример с использованием jQuery и [jQuery Cookie Plugin] (https://github.com/carhartl/jquery-cookie):

```html
<? $lang = (isset($_COOKIE['lang'])) ? $_COOKIE['lang'] : 'ru';?>

<?=App::t('Язык');?>

<select id='cmbLang'>
    <option value="ru" <?if ($lang=='ru') echo 'selected';?>>русский</option>
    <option value="en" <?if ($lang=='en') echo 'selected';?>>english</option>
</select>

<script>
    $(function () {
        /**
         * Переключалка языка интерфейса
         */
        $('#cmbLang').change(function() {
            var lang = this.value;
            if (lang == 'ru') {
                $.removeCookie('lang');
            } else {
                $.cookie('lang', this.value, {expires: 365});
            }
            location.reload();
        });
    )};
</script>
```

В этом примере на странице будет выпадающий список с двумя языками. При выборе языка страница перегрузится. Шаблон страницы должен содержать обращения к словарю через переводчик - `App::t()`. Этого достаточно, чтобы получить страницу на требуемом языке. Разумеется, если вы заполнили словарь для него. Подробности ниже. 

## Словари PHP

Словарь - простой php-скрипт или несколько скриптов. Имя главного из них должно подходить под регулярку `~^[a-z]{2,3}\.php$~i`

Рекомендую использовать 2-xбуквенные коды языков стандарта [ISO 639-1](https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes)

Внутри скриптов - асссоциативные массивы, ['русский_текст' => 'перевод'].

Например, ***en.php*** - основной словарь (для английского языка), к нему можно подключать подразделы через *array_merge()*.

```PHP
//en.php
return array_merge(
    [
        'Сайт про блины' => 'This is a site about pancakes',
        'Добро пожаловать, USER' => 'Welcome, USER',
    ],
    include 'en_admin.php', //локализация админки
    include 'en_user.php',  //локализация ЛК
);
```
Словарь загружается в класс *App* один раз при перевом обращении к переводчику и хранится до завершения работы приложения.

Подстановка значений в текст: **любой набор символов**, главное, чтоб не совпал с простым текстом.

Использование строки с переводом:

```PHP
echo App::t('Сайт про блины');
echo App::t('Добро пожаловать, USER', ['USER' => $this->userName]);
```

Второй параметр - необязательный. Если перевод не будет найден, вернется оригинальная строка.

Для русского языка php-словарь не требуется.

## Словари Javascript

В движке нет реализации js-переводчика. Я предлагаю сделать следующую. Заводим каталог, например [public/assets/js/i18n/]. Складываем в нем js-файлы по одному для каждого языка, **включая русский**. Тогда подключение в макете будет таким:

```html
    <script src="<?='/public/assets/js/i18n/'. App::detectLang() . '.js';?>"></script>
```

Метод-переводчик в [public/assets/js/i18n/en.js] выглядит так:

```javascript
/**
 * Перевод рус->англ
 */
String.prototype.t = function() {
    var lexicon = {
        'нажми меня': 'Click me',
        'Не учили не щекать куда-попало? ;)': 'Not taught not cheek somewhere horrible? ;)',
    };

    return (lexicon[this] == undefined) ? String(this) : lexicon[this];
}
```

Для русского языка перевод не требуется, но сам метод должен быть! Поэтому в [public/assets/js/i18n/ru.js] создаем "пустой" метод:

```javascript
//перевод с русского не требуется, сообщения по умолчанию на русском
String.prototype.t = function() { return String(this); }
```

Использование js-словаря:

```javascript
$('#anchor').html('нажми меня'.t());
```

#### Пример локализации Datepicker

В скриптах-словарях можно размещать локализованные значения плагинов. В частности, jQuery-UI.Datepicker позволяет задавать свои значения для названий месяцев и дней недели. 

[.../js/i18n/ru.js]

```javascript
//перевод с русского не требуется, сообщения по умолчанию на русском
String.prototype.t = function() { return String(this); }

//календарь (Datepicker)
var locNames = {
    monthNames: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь',
        'Октябрь', 'Ноябрь', 'Декабрь'],
    //Принудительно задаем полные названия, иначе смортится некрасиво
    //monthNamesShort: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
    monthNamesShort: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь',
        'Октябрь', 'Ноябрь', 'Декабрь'],
    dayNamesShort: ['Вск', 'Пнд', 'Втр', 'Срд', 'Чтв', 'Птн', 'Суб'],
    dayNamesMin: ['Вск', 'Пнд', 'Втр', 'Срд', 'Чтв', 'Птн', 'Суб'],
    dayNames: ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота']
};

```

[.../js/i18n/en.js]

```javascript
/**
 * Перевод рус->англ
 */
String.prototype.t = function() {
    var lexicon = {
        'Hедопустимые символы': 'Unacceptable symbols',
        'Пароль слишком короткий': 'Password is too short',
        // ...
    };

  return (lexicon[this] == undefined) ? String(this) : lexicon[this];
}

//календарь (Datepicker)
var locNames = {}
```

Настройка плагина:

```javascript
$(function () {
    $('#fmReg input[name="birth_date"]').datepicker(
        $.extend(
            locNames, {
                changeMonth: true,
                changeYear: true,
                dateFormat: 'dd.mm.yy',
            }
        )
    );
});
```

## Статичные страницы

Для подключения полностью статичных страниц на разных языках рекомендую завести их в отдельных подкаталогах, типа [views/i18n/XX/somePage.htm]. В контроллере код может быть таким:

```PHP
    public function somePage()
    {
        $lang = App::detectLang(); // текущий язык будет получен из печеньки
        $this->render("/i18n/{$lang}/somePage");
    }
```

---
