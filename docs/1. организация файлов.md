# Файловая организация

### Движок

Каждый скрипт движка сопровождается комментарием, поэтому тут не повторяю. 

***engine/***

Ядро движка. Классов немного, только самое основное. Наследовать от ядерных классов необязательно, но рекомендуется.

***utils/***

Утилиты. Кучка полезных методов, без которых в принципе можно обойтись, но они делают жизнь проще :) см. док *Утилиты*

***.htaccess***

Уже ставшие классическим, условия невыгодны:
```
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ index.php [L,QSA]
```
Они проверяют **каждый запрос** в стиле *"если не файл и не каталог, то.."*. Выяснение этого "если" - это проверка физического существования файла/каталога. Дисковые операции - это долго, причем тут неоправданно.

Рекомендую использовать такой:
```
RewriteEngine On
RewriteBase /
#Если запрос не совпадает с перечисленным - отправлять его в index.php
RewriteCond %{REQUEST_URI} !^/(index\.php|images|files|views/assets|robots\.txt|sitemap\.xml)
RewriteRule .* index.php [L,QSA]
```

Еще один плюс такого правила - запрещено прямое обращение к скриптам (в отличие от "классики"), все они пойдут через *index.php*. Не забудьте перенести **favicon.ico** в `images/` или добавить его в условие.

Так же можно настроить страницы с ошибками 
```Apache
ErrorDocument 401 /some/errorhandler
ErrorDocument 403 /some/errorhandler
ErrorDocument 404 /some/errorhandler
ErrorDocument 500 /some/errorhandler
``` 
чтобы и сайт и Apache реагировали одинаково. По поводу *errorHandler* для движка см. в доке *"Базовая конфигурация > Конфиг приложения"*.

В каталогах статики рекомендую настраивать права доступа к файлам *0666*, запрещая их исполнение. Так же не помешает настройка web-сервера на запрет выполнения файлов статики, как скриптов. Для этого в каталоге статики ложите свой `.htaccess`:

```Apache
php_flag engine 0
AddType "text/html" .php .cgi .pl .fcgi .fpl .phtml .shtml .php2 .php3 .php4 .php5 .asp .jsp
```

Будет работать, пока хакеры не перепищут этот файл :) И проверьте запрет доступа к этому файлу через web. Обычно конфигурация сервера защищает .ht-файлы от чтения.

Я предлагаю такой вариант конфигурации web-сервера для простых случаев, когда у вас только Apache порт слушает. Если же статикой рулит *nginx* с проксированием остальных запросов в *Apache*, то мне еще у вас учиться, а не рекомендации давать :)

### Приложение

Новое приложение можно создать через мастер, который размещен в подкаталоге [install/]. Если нет такого подкаталога, значит его предусмотрительно удалил тот, кто воспользовался мастером ранее :) 

***application/***

каталог приложения (сайта). Название - на свое усмотрение, см. константу **APP_PATH**.

***application/conf/main.php***

конфиг приложения. Обязательно. Определяется в константе **MAIN_CONFIG** Описание минимальной конфигурации см. в доке *"Базовая конфигурация > Конфиг приложения"*. 

***application/i18n/XX.php***

обязательно при использовании возможностей движка по локализации сайта. Файлы **xx.php** - языковые пакеты. Подробнее о локализации см. доке *"Локализация сайта"*

***views/*** 

каталог с представлениями (шаблонами) приложнения. Определяется в константе **VIEWS_PATH**.

***application/temp/*** 

Временный каталог приложения. Определяется в константе **TEMP_PATH**. В него, как минимум, складываются логи. **Обязательно создать этот каталог и дать к нему доступ, лучше полный, для процесса веб-сервера.** Не делаю проверку/создание такого каталога в коде, т.к. это неоправданно замедляет выполнение программы.

Для надежности можно запретить доступ запросами браузера, разместив в *temp*-каталоге `.htaccess`:

```Apache
    <Files *.*>
       deny from all
    </Files>
```

В случае использования другого веб-сервера ищите ответы в его мануалах. 

---

Остальная организация файлов и каталогов - свободная, на усмотрение разработчка. См. док *"Базовая конфигурация > Автозагрузка..."*

Примеры имен и расположение классов приложения:
```
    application/
        controllers/
            Main.php
        models/
            UserModel.php
            MySuperModel.php
        modules/
            user/
                controllers/
                    Login.php
                    Profile.php
                services/
                    ...
            admin/
                controllers/
                services/
                models/
        services/
            UserService.php
        init.php
        env.php
```
