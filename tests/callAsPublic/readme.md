# CallAsPublic - Unit test

В этом каталоге представлен трейт, с помощью которого можно тестировать непубличные методы в PHP.

В этом же каталоге лежит тест для проверки этого трейта - `CallAsPublicTest`. Он так же является **примером использования трейта**.

Как подключить: скопировать в нужный каталог с тестами приложения и явно прописать через `require` в `bootstrap.php` тестового окружения, см. на примере тестового окружения движка.

**Важно:** тестам движка этот трейт не требуется. Лежит здесь для примера и использования в конечных приложениях.

*Если у вас возникла необходимость тестировать непубличные методы, значит скорее всего проблемы в архитектуре приложения. Хотя мне известны исключения из этого утверждения, но вы присмотритесь :) ...*

## Ограничения

Этот трейт не может работать с методами, которые принимают параметры по ссылке. Я не придумал красивого решения. Придется все-таки открывать такие методы в публичную видимость и ставить тег `@ignore` или `@internal`.

Желающим попробовать найти решение - в добрый путь. В тестовом классе есть метод `SUTClass::impossible()`. Ваше решение должно успешно тестировать этот метод.

Очевидная идея - принимать в трейте параметры по ссылке, например так:

```PHP
protected function callMethod($class, string $methodName, &...$args)
{
...
}
```

Но тогда **все агрументы для любых тестируемых через трейт функций** придется передавать переменными. Типа:

```PHP
public function test_impossible()
{
    $var = 'some';                      // это действительно нужно
    $var2 = 12;                         // а это уже лишнее
    $const = SUTClass::IMPOSSIBLE_VAL;  // и это - лишнее
    $this->assertEquals(
        'success',
        $this->callMethod($class, 'impossible', $var, $var2, SUTClass::IMPOSSIBLE_VAL),
        'Метод с первым параметром-ссылкой'
    );
}
```

Это - уродливые костыли, имхо.
