<?
/**
 * Страница регистрации юзера
 *
 * RegistrationForm $form    модель формы
 * string           $minPass ограничение на длину пароля
 * string           $minComb ограничение на комбинацию символов в пароле
 * array            $imgConstrains ограничения на картинку
 */
use engine\App;

$data = $form->getRawdata();
$err = $form->getErrorsAsString();
?>

<h4><?= App::t('Регистрация нового пользователя'); ?></h4>
<p><?= App::t('Добро пожаловать!'); ?></p>
<p><?= App::t('Для регистрации заполните, пожалуйста, как минимум поля, отмеченные звездочкой.'); ?></p>

<? $this->renderPartial('_flash'); ?>

<? if ($form->hasErrors()) { ?>
    <br><span class='error'><?= App::t('При регистрации допущены ошибки'); ?></span>
<? } ?>

<form id='fmReg' method="POST" enctype="multipart/form-data">
	<div class='form-row'>
	    <label class='required'><?= App::t('Логин'); ?></label><br>
	    <input type='text' name='login' required maxlength=30 value='<?= $data['login']; ?>'>
	    <img class='gif-process' src='/public/images/process.gif'>
	    <span class='error'><?= $err['login']; ?></span><br>
	    <span class='hint'><?= App::t('Допускаются цифры, латинские буквы, тире и знак подчеркивания'); ?></span>
	</div>

	<div class='form-row'>
	    <label class='required'><?= App::t('Пароль'); ?></label><br>
	    <input type='password' name='password' required maxlength=30 value='<?= $data['password']; ?>'>
        <span class='error'><?= $err['password']; ?></span><br>
        <span id='js-pwd' data-pass='<?= $minPass; ?>' data-comb='<?= $minComb; ?>' class='hint'>
            <?= App::t('Минимальная длина пароля - N символов.', ['N' => $minPass]); ?><br>
            <?= App::t('Обязательная комбинация как минимум N-х из следующих наборов символов', ['N' => $minComb]); ?>
            :
	        <ul>
	            <li><?= App::t('цифры'); ?></li>
	            <li><?= App::t('буквы в нижнем регистре'); ?></li>
	            <li><?= App::t('буквы в верхнем регистре'); ?></li>
	            <li><?= App::t('спецсимволы:'); ?> _ - ! @ # $ % ^ & ` ~</li>
	        </ul>
        </span>
	</div>

    <div class='form-row'>
        <label class='required'>email</label><br>
        <input type='email' name='mail' required maxlength=50 value='<?= $data['mail']; ?>'>
        <img class='gif-process' src='/public/images/process.gif'>
        <span class='error'><?= $err['mail']; ?></span>
    </div>

    <div class='form-row'>
        <label><?= App::t('Имя'); ?></label><br>
        <input type='text' name='firstname' maxlength=50 value='<?= $data['firstname']; ?>'>
        <span class='error'><?= $err['firstname']; ?></span>
    </div>

    <div class='form-row'>
        <label><?= App::t('Фамилия'); ?></label><br>
        <input type='text' name='secondname' maxlength=50 value='<?= $data['secondname']; ?>'>
        <span class='error'><?= $err['secondname']; ?></span>
    </div>

    <div class='form-row'>
        <label><?= App::t('Пол'); ?></label>
        <? $sex = $data['sex'] ?: 'none'; ?>
        <select name='sex'>
            <option value="none" <? if ($sex == 'none') {
                echo 'selected';
            } ?>><?= App::t('не задан'); ?></option>
            <option value="female" <? if ($sex == 'female') {
                echo 'selected';
            } ?>><?= App::t('женский'); ?></option>
            <option value="male" <? if ($sex == 'male') {
                echo 'selected';
            } ?>><?= App::t('мужской'); ?></option>
        </select>
        <span class='error'><?= $err['sex']; ?></span>
    </div>

    <div class='form-row'>
        <label><?= App::t('Дата рождения'); ?></label><br>
        <input type='text' name='birth_date' value='<?= $data['birth_date']; ?>' placeholder='__.__.____'>
        <span class='error'><?= $err['birth_date']; ?></span>
    </div>

    <div class='form-row'>
        <label><?= App::t('Город проживания'); ?></label><br>
        <input type='text' name='town' maxlength=100 value='<?= $data['town']; ?>'>
        <span class='error'><?= $err['town']; ?></span><br>
        <span class='hint'><?= App::t('В произвольной форме. Например:') ?>Томск, Первопрестольная,
        c.Кукуево Брянской губернии, London, Марс :)</span>
    </div>

    <div class='form-row'>
    <?= App::t('Ваше фото'); ?>
    <? if ($fn = $form->getValues('avatar')) { ?>
        <br>
        <img class='avatar' src='<?= App::conf('avatar.url') . $fn; ?>' width='150px'>
        <input type='hidden' name='avatar' value='<?= $fn; ?>'>
    <? } else { ?>
        <input type='file' name='avatar' accept="image/jpeg,image/png,image/gif">
        <span class='error'><?= $err['avatar']; ?></span><br>
        <span class='hint'>
	        <?= App::t('Формат файла - FORMAT.', ['FORMAT' => $imgConstrains['format']]); ?>
            <?= App::t('Размер изображения не меньше SIZE px по узкой стороне, вес файла в пределах MIN Кбайт - MAX Мб.',
                [
                    'SIZE' => $imgConstrains['min_size'],
                    'MIN' => $imgConstrains['min_weight'],
                    'MAX' => $imgConstrains['max_weight'],
                ]);
            ?>
	    </span>
    <? } ?>
    </div>

    <br>
	<div class='form-row'><input type='submit' value='<?= App::t('зарегистрироваться'); ?>'></div>
	<br>
</form>
