<h3>Создание нового приложения</h3>

<p>Мастер создания приложения очень упрощен и не охватывает все многообразие возможных сайтов, СУБД и фантазию кодера. Мастер написан для легкого старта работы с движком, не более того.</p>

<form method="POST">
    <div class="note info">
        <p>При указании путей рекомендую использовать прямые слеши (" / ") независимо от вашей <abbr title="операционная система">ОС</abbr>. Движок поддерживает кроссплатформу и все равно преобразует пути к прямым слешам.</p>

        <p>Объявляемые тут каталоги не должны существовать на момент создания приложения. Это необходимо во избежание случайной перезаписи содержимого каталогов. После создания, назначаются <strong>полные права доступа</strong> к каталогам.</p>
    </div>

    <?php if ($errors['required']): ?>
        <div class="note error"><?=$errors['required']?></div>
    <?php endif ?>

    <div class="row">
        <h4>Необходимый минимум</h4>

        <label>Каталог приложения</label>
        <div class="grayed take-left"><?=ROOT_PATH?></div>
        <div class="input-wrapper">
            <input type="text" name="path[app]" id="app-path" value="<?=$d['path']['app']?>">
        </div>

        <label class="clear-float">Каталог шаблонов</label>
        <div class="grayed take-left"><?=ROOT_PATH?></div>
        <div class="input-wrapper">
            <input type="text" name="path[view]" id="view-path" value="<?=$d['path']['view']?>">
        </div>

        <label class="clear-float">Каталог временных файлов</label>
        <div class="grayed take-left"><?=ROOT_PATH?></div>
        <div class="input-wrapper">
            <input type="text" name="path[temp]" id="temp-path" value="<?=$d['path']['temp']?>">
        </div>

        <label class="clear-float">Путь к основному файлу конфигурации приложения</label>
        <div class="grayed take-left"><?=ROOT_PATH?></div>
        <div class="input-wrapper">
            <input type="text" name="main_conf" id="main-conf" value="<?=$d['main_conf']?>">
        </div>

        <hr>

        <div class="take-left cell-6">
            Префикс пространства имен приложения (может отличаться от каталога приложения)
        </div>
        <div class="input-wrapper">
            <input type="text" name="ns_prefix" placeholder="например 'app'" value="<?=$d['ns_prefix']?>">
        </div>

         <hr class="clear-float">

            <div class="clear-float take-left">Email администратора</div>
            <div class="input-wrapper"><input type="email" name="email" value="<?=$d['email']?>"></div>
    </div>

    <div class="note info">
        <p>В конфигурации БД подразумевается СУБД <strong>MySQL</strong>. Для других серверов вам потребуется вручную исправить конфиги. И да, кодировки только две :) Установка иной кодировки - задача непростая.</p>

        <p>Указываемая вами база данных должна существовать на сервере, мастер ее создавать не будет. Это обусловлено тем, что обычно для такой операции требуются особые права, да и не каждая хостинг-компания такие права дает.</p>
    </div>

    <?php if ($errors['db']): ?>
        <div class="note error"><?=$errors['db']?></div>
    <?php endif ?>

    <div class="row">
        <h4>Конфигурация БД</h4>

        <div class="take-left">Сервер[:порт]</div>
        <div class="input-wrapper">
            <input type="text" name="db[server]" id="db-server" value="<?=$d['db']['server']?>">
        </div>

        <div class="clear-float cell-6">
            <div class="take-left">Имя базы</div>
            <div class="input-wrapper">
                <input type="text" name="db[name]" id="db-name" value="<?=$d['db']['name']?>">
            </div>
        </div>

        <div class="cell-6 with-select">
            <span class="pl-5">Кодировка</span>
            <select name="db[charset]" id="db-charset">
                <option value="utf8" <?php if ($d['db']['charset'] == 'utf8') echo 'selected'?>>utf8</option>
                <option value="cp1251" <?php if ($d['db']['charset'] == 'cp1251') echo 'selected'?>>cp1251</option>
            <select>
        </div>

        <div class="clear-float">DSN: <span id="dsn">none</span><hr></div>

        <div class="cell-6">
            <div class="take-left">Пользователь</div>
            <div class="input-wrapper"><input type="text" name="db[user]" value="<?=$d['db']['user']?>"></div>
        </div>

         <div class="cell-6">
            <div class="take-left pl-5">Пароль</div>
            <div class="input-wrapper">
                <input type="password" name="db[password]" value="<?=$d['db']['password']?>">
            </div>
        </div>
    </div>

    <div class="note info">
        <p>Логер вообще можно не настраивать. По умолчанию он включен, пишет лог в файлы, складывает их в temp-каталог приложения.</p>

        <p><strong>Каталог для логов</strong> желательно задать даже при логировании в БД. В случае ошибок базы, лог пойдет в файлы.</p>

        <p><strong>Часовой пояс</strong>: сайт может работать в одном поясе, а логи можно писать в поясе хостера хотя бы для того, чтобы <nobr>в случае</nobr> сбоя вести диалог с тех.поддержкой про одно и тоже время.</p>
    </div>

    <?php if ($errors['log']): ?>
        <div class="note error"><?=$errors['log']?></div>
    <?php endif ?>

    <div class="row">
        <h4>Конфигурация логера</h4>

        <div>
            <label><input type="checkbox" name="log[switch]" <?php if ($d['log']['switch']) echo 'checked="checked"'?>>
            Включить логирование</label>
        </div>

        <div class="cell-3 with-select">
            Писать логи в
            <select name="log[store]" id="log-store">
                <option disabled <?php if (!$d['log']['store']) echo 'selected'?>> ... </option>
                <option value="db" <?php if ($d['log']['store'] == 'db') echo 'selected'?>>базу</option>
                <option value="files" <?php if ($d['log']['store'] == 'files') echo 'selected'?>>файлы</option>
            <select>
        </div>

        <div class="cell-9">
            <div id="log-db-warn" class="mt-5" style="display: none;">Требуется определить конфигурацию БД</div>
            <div id="log-db-table" style="display: none;">
                <div class="take-left">Имя таблицы для логов</div>
                <div class="input-wrapper">
                    <input type="text" name="log[table]" value="<?=$d['log']['table'] ? : 'kira_log'?>">
                </div>
            </div>
        </div>

        <div class="cell-12">
            <label class="clear-float take-left">Каталог для логов:</label>
            <div class="grayed take-left"><?=ROOT_PATH?></div>
            <div class="input-wrapper">
                <input type="text" name="log[path]" id="log-path" value="<?=$d['log']['path']?>">
            </div>
        </div>

        <div class="cell-12">
            <div class="take-left">Часовой пояс в логах</div>
            <div class="input-wrapper">
                <input type="text" name="log[timezone]" value="<?=$d['log']['timezone']?>"
                    placeholder="пояс по версии PHP">
            </div>
        </div>
    </div>

    <div class="note info">
        <p>Если ваш сайт будет переведен на несколько языков, здесь вы можете указать их коды. Будут созданы заготовки языковых пакетов:</p>

        <ul>
            <li>в каталоге приложения - подкаталог <span class="inline-code">i18n/</span>, в котором размещаются php-скрипты со "словарями". Один язык - один файл.</li>
            <li>в каталоге шаблонов - подкаталоги типа <span class="inline-code">i18n/&lt;lang&gt;/</span> для хранения статичных страниц сайта на разных языках.</li>
            <li>в каталоге с js-скриптами (который вы укажете ниже) - подкаталог <span class="inline-code">i18n/</span>, содержащий словари для перевода строк в javascript.</li>
        </ul>

        <p>При выборе кодов рекомендую использовать 2-xбуквенные обозначения языков стандарта <a href='https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes' target="_blank" title="Wikipedia. List of ISO 639-1 codes">ISO 639-1</a>.</p>
    </div>

    <?php if ($errors['lang']): ?>
        <div class="note error"><?=$errors['lang']?></div>
    <?php endif ?>

    <div class="row">
        <h4>Языковая поддержка</h4>

        <div>
            <label><input type="checkbox" name="lang[switch]"
                <?php if ($d['lang']['switch']) echo 'checked="checked"'?>> Создать окружение</label>
        </div>

        <div class="cell-12">
            <div class="take-left">Код основного языка: <strong>ru</strong>. Другие языки, через запятую</div>
            <div class="input-wrapper"><input type="text" name="lang[other]" value="<?=$d['lang']['other']?>"></div>
        </div>

        <div class="cell-12">
            <label class="clear-float">Путь к js-скриптам приложения</label>
            <div class="grayed take-left"><?=ROOT_PATH?></div>
            <div class="input-wrapper">
                <input type="text" name="lang[js_path]" id="js-path" value="<?=$d['lang']['js_path']?>">
            </div>
        </div>
    </div>

    <input type="submit" value="СОЗДАТЬ">
</form>

<script src='/install/static/script.js'></script>
